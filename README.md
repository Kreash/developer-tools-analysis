
# Использование Chrome DevTools - анализ открытия сайта.

## 1 Network

### 1.1 профиль загрузки ресурсов при открытии страницы - [www.gd.ru.har](./network/www.gd.ru.har)

### 1.2 Неоптимальные места

#### 1.2.1 дублирование ресурсов

- popper.min.js
  ![Alt text](/network/image.png)
- openapi.js
  ![Alt text](/network/image-1.png)
- jquery-3.5.1.js
  ![Alt text](/network/image-2.png)
- code.js
  ![Alt text](/network/image-3.png)
- bootstrap.min.js, bootstrap.min.css, bootstrap.bundle.min.js
  ![Alt text](/network/image-4.png)
- fontawesome-webfont.woff2?v=4.7.0
  ![Alt text](/network/image-5.png)
- system_gd-logo.png
  ![Alt text](/network/image-6.png)
- data:image/png;base64...
  ![Alt text](/network/image-7.png)

#### 1.2.2 Лишний размер ресурса

- Первый загружаемый файл 9039-finansovyy-kontrol имеет много инлайновых скриптов и стирей (js и css непосредственно написанные в тегах script и style). Если посмотреть на документ в coverage. То можно увидеть, что после разгузки используется только 60% из всего документа. Вынос неиспользованных js и css в отдельные файлы и дозагрука позволит уменьшить размер первого загружаемого файла, а то есть время до первого взаимодействия со страницей + дать браузеру решать как более эффективно загрузить данные ресурсы. (браузер очень хитро умеет решать какие файлы нужно загрузить заранее, а какие можно отложить на потом)
  ![Alt text](/network/image-8.png)
  ![Alt text](/network/image-9.png)

- Второй загружаемый файл context.js имеет большой вес 316кб (91.6кб gzip) и подключён в теге head. А то есть пока весь файл не загрузится страница не отрендерится. Подобные большие файлы принято подключать в конце body, таким образом страница успеет сначал отрендериться, а потом загрузить необходимые скрипты. Файл получается от стороннего сервиса, так что врядли можно напрямую сократить его вес напрямую. Но скорее всего можно отложить загрузку такого большого файла установкой свойства
  ![Alt text](/network/image-10.png)

- common_frontend.css - Имеет большой размер 86% которого не используетс при первой загрузке. Можно вынести неиспользуемые стили в другой файл и загружать их позже
  ![Alt text](/network/image-11.png)
  ![Alt text](/network/image-12.png)
- base.js так же имеет большой размер и находится в теге head, что опять же блокирует первую отрисовку страницы
  ![Alt text](/network/image-13.png)
- Так же всё описанное выше относится и ко всем файлам представленным на скриншоте ниже
  ![Alt text](/network/image-22.png)

#### 1.2.3 медленно загружающиеся ресурсы

На странице присутствует большое количество медленно загружающихся файлов. Описание отдельно каждого из них будет слишком грамоздко, так что они представлены скриншотами. (выборка от 500ms)
![Alt text](/network/image-14.png)
![Alt text](/network/image-15.png)
![Alt text](/network/image-16.png)
![Alt text](/network/image-17.png)

#### 1.2.4 ресурсы, блокирующие загрузку

На странице присутствует большое количество ресурсов блокирующих загрузку страницы. Дабы не описывать каждый отдельно они представлены скриншотами. Данные ресурсы можно разделить на несколько групп.

- Файлы стилей (.css), которые загружаются тегами link находящимися в теге head. Они блокируют рендер. Ни в одном из тегов link не использованы медиа-запросы (например media="print"), которые говорят браузеру какого рода стили находятся в каждом файле и дают ему принять решение, какие из этих файлов можно загрузить мозже не блокирую рендер страници и загрузку остальных файлов (по умолчанию файлы стилей имеют высокий приоритет загрузки)
- Скрипты (.js), которые загружаются тегами script находящимися в теге head. Расположение скриптов в теге head даёт им высокий приоритет загрузки из-за чего происходит блокировка рендера страницы и загрузки других более необходимых файлов (например шрифтов). Большинство скриптовых файлов можно переместить в конец тега body, выделить из них неиспользуюмый код в другие файлы, либо использовать другие способы, говорящие браузеру, что данные скрипты можно загрузить позже.
- Большое количество медиафайлов, которые не используются в видимой части страницы. Загрузку таких ресурсов можно отложить, чтобы дать возможность пользователю раньше взаимодействовать со транице
  ![Alt text](/network/image-18.png)
  ![Alt text](/network/image-19.png)
  ![Alt text](/network/image-20.png)
  ![Alt text](/network/image-21.png)

#### 1.2.5 что-то ещё

- Запросы со статусом 302
  ![Alt text](/network/image-23.png)
- CORS Error
  ![Alt text](/network/image-24.png)
  ![Alt text](/network/image-26.png)
- Маленькие jpeg картинки. В данном случае использование jpeg не даёт приемуществ. Стоит заменить их на png, либо на более современные webp или avif (у avif ещё плохая поддержка, но он предоставляет лучшее сжатие)
  ![Alt text](/network/image-25.png)/
- Кнопки, которые можно было сделать с помощью нескольких строк css загружаются как отдельный изображения
  ![Alt text](/network/image-27.png)

## 2 Performance

### 2.1 профиль загрузки страницы [Trace.json](https://disk.yandex.ru/d/vRtf-ACKATnfdg)

### 2.2 время в миллисекундах от начала навигации до событий

- First Paint (FP) - 2256.1 ms
- First Contentful Paint (FCP) - 2256.1 ms
- DOM Content Loaded (DCL) - 7850.0 ms
- Largest Contentful Paint (LCP) - 9759.3 ms
- Load - 27998.8 ms

### 2.3 DOM-элемент на котором происходит LCP

`<img loading="lazy" src="/images/branding/10/imageTop_1628667062.7856.jpg" data-url="/images/branding/10/imageTop_1628667062.7856.jpg" alt="-">`
![Alt text](./perfomance/image.png)

### 2.4 Время на этапы обработки документа

Учитывается время от начала загрузки страницы до события Load

- Loading - 312 ms
- Scripting - 12249 ms
- Rendering - 3574 ms
- Painting - 1099 ms

![Alt text](./perfomance/image-1.png)

## 3 Coverage

### 3.1 Cкриншот вкладки после загрузки страницы

![Alt text](./coverage/image-2.png)

### 3.2 Объём неиспользованного CSS в ходе загрузки страницы

- Unused CSS 566kB

### 3.3 Объём неиспользованного JS в ходе загрузки страницы

- Unused JS 2.3MB

# Анализ при замедлении CPU 4x slowdown и эмуляции сети Slow 3G

## 1 Network

### 1.1 профиль загрузки ресурсов при открытии страницы - [www.gd.ru-slow.har](./network/www.gd.ru-slow.har)

### 1.2 Неоптимальные места

- Всё тоже самое, что и при первом тесте, только дольше.

## 2 Performance

### 2.1 профиль загрузки страницы [Trace-slow.json](https://disk.yandex.ru/d/54g3FV25XAmUbg)

### 2.2 время в миллисекундах от начала навигации до событий

- First Paint (FP) - 19856.0 ms
- First Contentful Paint (FCP) - 19856.0 ms
- DOM Content Loaded (DCL) - 51320.3 ms
- Largest Contentful Paint (LCP) - 78391.0 ms
- Load - 101955.5 ms

### 2.3 DOM-элемент на котором происходит LCP

`<img src="/themes/gd_ru/assets/frontend/images/logo.png" alt="Генеральный Директор" title="Генеральный Директор" loading="lazy">`
![Alt text](./perfomance/image-4.png)

### 2.4 Время на этапы обработки документа

Учитывается время от начала загрузки страницы до события Load

- Loading - 419 ms
- Scripting - 11457 ms
- Rendering - 3176 ms
- Painting - 464 ms

![Alt text](./perfomance/image-3.png)

## 3 Coverage

- Показал теже самые данные, что и первый тест
